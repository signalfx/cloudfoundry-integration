---
name: signalfx-agent-new  # TODO: take off '-new' once we have retired the Java version
icon_file: resources/icon.png
label: SignalFx Agent (NEW)
description: Reports Cloud Foundry platform metrics to SignalFx

# Global defaults (all optional)
#
# org: test-org                         # Name of org to create for your apps
# space: test-space                     # Name of space to create for your apps
apply_open_security_group: true         # Apply open security group, default: false

instance_definition:
  name: instances
  type: integer
  configurable: false
  default: 1
  constraints:
    max: 1

# Specify the packages to be included in your tile.
# The format of the section to include depends on the type
# of package you are describing. For fragments of each type
# that you can copy & paste, see:
#
# https://github.com/cf-platform-eng/tile-generator/blob/master/README.md
#
packages:
- name: signalfx-agent-new
  type: bosh-release
  path: bosh-release/dev_releases/signalfx-agent-new/signalfx-agent-new-0+dev.1.tgz
  label: SignalFx Agent (NEW)
  jobs:
  - name: signalfx_agent_new
    memory: 1024
    cpu: 2
    static_ip: 1
    properties:
      uaa:
        url: (( .properties.uaa_url ))
        username: (( .properties.uaa_username ))
        password: (( .properties.uaa_password ))

# Uncomment this section if you want to display forms with configurable
# properties in Ops Manager. These properties will be passed to your
# applications as environment variables. You can also refer to them
# elsewhere in this template by using:
#     (( .properties.<property-name> ))
#
forms:
- name: core_properties
  label: Core
  description: Core configuration that is required for the agent to work
  properties:
  - name: signalfx_access_token
    type: string
    label: SignalFx API Access Token
    description: The SignalFx API access token.  You can get this from the SignalFx admin tab.
  - name: cloudfoundry_api_url
    type: string
    label: CloudFoundry API URL/IP
    description: The URL/IP address of the CloudFoundry/CloudController API in your platform
  - name: uaa_url
    type: string
    label: UAA URL
    description: The URL/IP address of the UAA server in your deployment to authenticate the agent to access the firehose
  - name: uaa_username
    type: string
    label: UAA Username
    description: Username that has the appropriate permissions to access the firehose
  - name: uaa_password
    type: string
    label: UAA Password
    description: Password for the UAA username specified above
- name: agent_properties
  label: Metric Agent
  description: Configuration rele
  properties:
  - name: signalfx_ingest_url
    type: string
    label: SignalFx ingestion URL
    default: https://ingest.signalfx.com


# Customize upgrade parameters if the defaults don't meet your needs.
#
# update:
#   canaries: 1
#   canary_watch_time: 10000-100000
#   max_in_flight: 1
#   update_watch_time: 10000-100000

# If prior versions of your tile are installed and configured, their
# property values will not be overwritten by new defaults provided
# in this file. If that is your intent, you must do the overwriting
# explicitly using JavaScript migration functions, like so:
#
# migration: |
#   properties['properties']['.properties.org']['value'] = 'system';
